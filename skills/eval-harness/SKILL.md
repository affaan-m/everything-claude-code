---
name: eval-harness
description: 評価駆動開発（EDD）の原則を実装したClaude Codeセッションの正式な評価フレームワーク。
---

# 評価ハーネススキル

評価駆動開発（EDD）の原則を実装したClaude Codeセッションの正式な評価フレームワーク。

## 哲学

評価駆動開発は評価を「AI開発のユニットテスト」として扱います:

- 実装の前に期待される動作を定義
- 開発中に継続的に評価を実行
- 各変更でリグレッションを追跡
- 信頼性測定のためにpass@kメトリクスを使用

## 評価タイプ

### 機能評価

Claudeが以前できなかったことができるようになったかをテスト:

```markdown
[機能評価: 機能名]

タスク: Claudeが達成すべきことの説明

成功基準:
- [ ] 基準1
- [ ] 基準2
- [ ] 基準3

期待される出力: 期待される結果の説明
```

### リグレッション評価

変更が既存の機能を壊していないことを確認:

```markdown
[リグレッション評価: 機能名]

ベースライン: SHAまたはチェックポイント名

テスト:
- existing-test-1: パス/失敗
- existing-test-2: パス/失敗
- existing-test-3: パス/失敗

結果: X/Y パス（以前はY/Y）
```

## グレーダータイプ

### 1. コードベースグレーダー

コードを使用した決定論的チェック:

```bash
# ファイルが期待されるパターンを含むかチェック
grep -q "export function handleAuth" src/auth.ts && echo "PASS" || echo "FAIL"

# テストがパスするかチェック
npm test -- --testPathPattern="auth" && echo "PASS" || echo "FAIL"

# ビルドが成功するかチェック
npm run build && echo "PASS" || echo "FAIL"
```

### 2. モデルベースグレーダー

オープンエンドな出力を評価するためにClaudeを使用:

```markdown
[モデルグレーダープロンプト]

以下のコード変更を評価してください:

1. 述べられた問題を解決しているか？
2. 構造は良好か？
3. エッジケースは処理されているか？
4. エラーハンドリングは適切か？

スコア: 1-5（1=不良、5=優秀）
理由: [説明]
```

### 3. 人間グレーダー

手動レビュー用にフラグ:

```markdown
[人間レビュー必要]

変更: 何が変更されたかの説明
理由: なぜ人間レビューが必要か
リスクレベル: 低/中/高
```

## メトリクス

### pass@k

「k回の試行で少なくとも1回成功」

- pass@1: 初回試行成功率
- pass@3: 3回以内の成功
- 典型的な目標: pass@3 > 90%

### pass^k

「k回すべてのトライアルが成功」

- より高い信頼性の基準
- pass^3: 3回連続成功
- 重要なパスに使用

## 評価ワークフロー

### 1. 定義（コーディング前）

```markdown
## 評価定義: feature-xyz

### 機能評価
1. 新しいユーザーアカウントを作成できる
2. メール形式を検証できる
3. パスワードを安全にハッシュできる

### リグレッション評価
1. 既存のログインがまだ機能する
2. セッション管理が変更されていない
3. ログアウトフローがそのまま

### 成功メトリクス
- 機能評価のpass@3 > 90%
- リグレッション評価のpass^3 = 100%
```

### 2. 実装

定義された評価をパスするコードを書く。

### 3. 評価

```bash
# 機能評価を実行
[各機能評価を実行、パス/失敗を記録]

# リグレッション評価を実行
npm test -- --testPathPattern="existing"

# レポートを生成
```

### 4. レポート

```markdown
評価レポート: feature-xyz
========================

機能評価:
  create-user: パス (pass@1)
  validate-email: パス (pass@2)
  hash-password: パス (pass@1)
  全体: 3/3 パス

リグレッション評価:
  login-flow: パス
  session-mgmt: パス
  logout-flow: パス
  全体: 3/3 パス

メトリクス:
  pass@1: 67% (2/3)
  pass@3: 100% (3/3)

ステータス: レビュー準備完了
```

## ベストプラクティス

1. **コーディング前に評価を定義** - 成功基準について明確に考えることを強制
2. **評価を頻繁に実行** - 早期にリグレッションをキャッチ
3. **時間経過でpass@kを追跡** - 信頼性のトレンドを監視
4. **可能な場合はコードグレーダーを使用** - 決定論的 > 確率的
5. **セキュリティには人間レビュー** - セキュリティチェックを完全に自動化しない
6. **評価を高速に保つ** - 遅い評価は実行されない
7. **評価をコードと一緒にバージョン管理** - 評価は一級のアーティファクト
